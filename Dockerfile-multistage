# ---------- client build ----------
FROM node:18-alpine AS client-build
WORKDIR /app/client
COPY client/package*.json ./
RUN npm ci --no-audit --no-fund
COPY client/ ./
RUN npm run build

# ---------- server runtime ----------
FROM node:18-alpine
WORKDIR /app/server

# Only server deps
COPY server/package*.json ./
RUN npm ci --omit=dev --no-audit --no-fund

# Server source
COPY server/ ./

# Bring in built client assets
COPY --from=client-build /app/client/dist/ ./public/

EXPOSE 5000
CMD ["npm","start"]
